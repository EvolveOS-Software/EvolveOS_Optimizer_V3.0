<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="EvolveOS_Optimizer.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:EvolveOS_Optimizer.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:EvolveOS_Optimizer.Utilities.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="24" Margin="28,20,28,40">

            <StackPanel Spacing="4">
                <TextBlock Text="{x:Bind GetText('Settings_Appearance_Title'), Mode=OneWay}" 
                           Style="{StaticResource TitleTextBlockStyle}" FontSize="28" FontWeight="Bold"/>
                <TextBlock Text="{x:Bind GetText('Settings_Appearance_Subtitle'), Mode=OneWay}" 
                           Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
            </StackPanel>

            <Border Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="8" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel VerticalAlignment="Center" Spacing="2">
                        <TextBlock Text="{x:Bind GetText('Settings_Language_Title'), Mode=OneWay}" FontWeight="SemiBold"/>
                        <TextBlock Text="{x:Bind GetText('Settings_Language_Subtitle'), Mode=OneWay}" 
                                   Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    </StackPanel>
                    <ComboBox x:Name="LanguageSelector" Grid.Column="1" Width="200" SelectionChanged="LanguageSelector_SelectionChanged">
                        <ComboBoxItem Content="English" Tag="en-us"/>
                        <ComboBoxItem Content="FranÃ§ais" Tag="fr-fr"/>
                        <ComboBoxItem Content="Nederlands" Tag="nl-nl"/>
                    </ComboBox>
                </Grid>
            </Border>

            <StackPanel Spacing="12">
                <StackPanel Spacing="12">
                    <Border Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="8" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Spacing="12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel VerticalAlignment="Center" Spacing="2">
                                    <TextBlock Text="{x:Bind GetText('Settings_Backdrop_Title'), Mode=OneWay}"
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind GetText('Settings_Backdrop_Subtitle'), Mode=OneWay}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>
                                <ComboBox x:Name="BackdropSelector"
                                          Grid.Column="1"
                                          Width="200"
                                          VerticalAlignment="Center"
                                          SelectionChanged="BackdropSelector_SelectionChanged">
                                    <ComboBoxItem Tag="None"/>
                                    <ComboBoxItem Tag="Mica"/>
                                    <ComboBoxItem Tag="MicaAlt"/>
                                    <ComboBoxItem Tag="Acrylic"/>
                                    <ComboBoxItem Tag="AcrylicThin"/>
                                </ComboBox>
                            </Grid>

                            <StackPanel x:Name="AcrylicOptionsPanel" Spacing="16" Margin="0,12,0,0" Visibility="Collapsed" Opacity="0">
                                <StackPanel.RenderTransform>
                                    <TranslateTransform x:Name="PanelTransform" Y="-15"/>
                                </StackPanel.RenderTransform>

                                <StackPanel.Resources>
                                    <Storyboard x:Name="ShowPanelAnimation">
                                        <DoubleAnimation Storyboard.TargetName="AcrylicOptionsPanel" Storyboard.TargetProperty="Opacity" To="1.0" Duration="0:0:0.3"/>
                                        <DoubleAnimation Storyboard.TargetName="PanelTransform" Storyboard.TargetProperty="Y" To="0" Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <ExponentialEase Exponent="6" EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </StackPanel.Resources>
                                
                                <MenuFlyoutSeparator/>

                                <StackPanel Spacing="4">
                                    <Grid>
                                        <TextBlock Text="Tint Opacity"
                                                   Style="{StaticResource CaptionTextBlockStyle}"/>
                                        <TextBlock Text="{x:Bind TintOpacitySlider.Value, Mode=OneWay}"
                                                   HorizontalAlignment="Right"
                                                   Style="{StaticResource CaptionTextBlockStyle}"/>
                                    </Grid>
                                    <Slider x:Name="TintOpacitySlider"
                                            Minimum="0" Maximum="1"
                                            StepFrequency="0.01"
                                            ValueChanged="AcrylicSlider_ValueChanged"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <Grid>
                                        <TextBlock Text="Luminosity Opacity"
                                                   Style="{StaticResource CaptionTextBlockStyle}"/>
                                        <TextBlock Text="{x:Bind LuminositySlider.Value, Mode=OneWay}"
                                                   HorizontalAlignment="Right"
                                                   Style="{StaticResource CaptionTextBlockStyle}"/>
                                    </Grid>
                                    <Slider x:Name="LuminositySlider"
                                            Minimum="0"
                                            Maximum="1"
                                            StepFrequency="0.01"
                                            ValueChanged="AcrylicSlider_ValueChanged"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="Tint Color"
                                               Style="{StaticResource CaptionTextBlockStyle}"/>
                                    <DropDownButton x:Name="AcrylicColorButton" HorizontalAlignment="Stretch">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Border x:Name="ColorPreview"
                                                    Width="20" Height="20"
                                                    CornerRadius="10"
                                                    Background="{ThemeResource Brush_Accent}"
                                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                    BorderThickness="1"/>
                                            <TextBlock Text="Change Tint Color"/>
                                        </StackPanel>
                                        <DropDownButton.Flyout>
                                            <Flyout Placement="Bottom">
                                                <StackPanel Spacing="10">
                                                    <ColorPicker x:Name="AcrylicColorPicker"
                                                                 IsColorSliderVisible="True"
                                                                 IsAlphaSliderVisible="False"
                                                                 ColorChanged="AcrylicColorPicker_ColorChanged"/>
                                                    <Button Content="Reset to Default"
                                                            HorizontalAlignment="Stretch"
                                                            Click="ResetAcrylicColor_Click"/>
                                                </StackPanel>
                                            </Flyout>
                                        </DropDownButton.Flyout>
                                    </DropDownButton>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="8" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel VerticalAlignment="Center" Spacing="2">
                            <TextBlock Text="{x:Bind GetText('Settings_Theme_Title'), Mode=OneWay}" FontWeight="SemiBold"/>
                            <TextBlock Text="{x:Bind GetText('Settings_Theme_Subtitle'), Mode=OneWay}" 
                           Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                        </StackPanel>
                        <ComboBox x:Name="ThemeSelector" Grid.Column="1" Width="200" VerticalAlignment="Center" SelectionChanged="ThemeSelector_SelectionChanged">
                            <ComboBoxItem Content="{x:Bind GetText('Settings_Theme_Default'), Mode=OneWay}" Tag="Default"/>
                            <ComboBoxItem Content="{x:Bind GetText('Settings_Theme_Light'), Mode=OneWay}" Tag="Light"/>
                            <ComboBoxItem Content="{x:Bind GetText('Settings_Theme_Dark'), Mode=OneWay}" Tag="Dark"/>
                        </ComboBox>
                    </Grid>
                </Border>

                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="8" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                    <StackPanel Spacing="16">
                        <StackPanel Spacing="2">
                            <TextBlock Text="{x:Bind GetText('Settings_AccentColor_Title'), Mode=OneWay}" FontWeight="SemiBold"/>
                            <TextBlock Text="{x:Bind GetText('Settings_AccentColor_Subtitle'), Mode=OneWay}" 
                                       Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                        </StackPanel>

                        <StackPanel Width="412" HorizontalAlignment="Left" Spacing="8">
                            <GridView x:Name="ColorPalette" 
                                      SelectionMode="Single" 
                                      SelectionChanged="ColorPalette_SelectionChanged"
                                      HorizontalAlignment="Center"
                                      Padding="6" 
                                      IsItemClickEnabled="True">
                                <GridView.ItemContainerStyle>
                                    <Style TargetType="GridViewItem">
                                        <Setter Property="Margin" Value="4"/>
                                        <Setter Property="MinWidth" Value="0"/>
                                        <Setter Property="MinHeight" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="GridViewItem">
                                                    <Grid x:Name="RootGrid" Background="Transparent" RenderTransformOrigin="0.5,0.5">
                                                        <VisualStateManager.VisualStateGroups>
                                                            <VisualStateGroup x:Name="CommonStates">
                                                                <VisualState x:Name="Normal"/>
                                                                <VisualState x:Name="PointerOver">
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetName="RootGrid" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)" To="1.15" Duration="0:0:0.1"/>
                                                                        <DoubleAnimation Storyboard.TargetName="RootGrid" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)" To="1.15" Duration="0:0:0.1"/>
                                                                    </Storyboard>
                                                                </VisualState>
                                                            </VisualStateGroup>
                                                        </VisualStateManager.VisualStateGroups>
                                                        <Grid.RenderTransform>
                                                            <CompositeTransform/>
                                                        </Grid.RenderTransform>
                                                        <ContentPresenter/>
                                                        <Border x:Name="SelectionBorder" 
                                                                BorderBrush="{ThemeResource SystemControlForegroundBaseHighBrush}" 
                                                                BorderThickness="2" 
                                                                Margin="-5" 
                                                                CornerRadius="6" 
                                                                IsHitTestVisible="False"
                                                                Visibility="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                    </Grid>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </GridView.ItemContainerStyle>

                                <GridView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <ItemsWrapGrid MaximumRowsOrColumns="10" Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </GridView.ItemsPanel>

                                <GridView.Items>
                                    <Rectangle Width="32" Height="32" Fill="#FF0078D4" Tag="#FF0078D4" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF0063B1" Tag="#FF0063B1" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF0099BC" Tag="#FF0099BC" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF004E8C" Tag="#FF004E8C" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF00B7C3" Tag="#FF00B7C3" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF107C10" Tag="#FF107C10" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF00CC6A" Tag="#FF00CC6A" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF00B294" Tag="#FF00B294" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF018574" Tag="#FF018574" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF10893E" Tag="#FF10893E" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFD13438" Tag="#FFD13438" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFE81123" Tag="#FFE81123" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFEA005E" Tag="#FFEA005E" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFE3008C" Tag="#FFE3008C" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFBF0077" Tag="#FFBF0077" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFB146C2" Tag="#FFB146C2" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF744DA9" Tag="#FF744DA9" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF8764B8" Tag="#FF8764B8" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF4010AD" Tag="#FF4010AD" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF881798" Tag="#FF881798" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFFF8C00" Tag="#FFFF8C00" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFF7630C" Tag="#FFF7630C" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFCA5010" Tag="#FFCA5010" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFFFB900" Tag="#FFFFB900" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FFFCE100" Tag="#FFFCE100" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF4C4A48" Tag="#FF4C4A48" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF68768A" Tag="#FF68768A" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF515C6B" Tag="#FF515C6B" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF486860" Tag="#FF486860" RadiusX="4" RadiusY="4"/>
                                    <Rectangle Width="32" Height="32" Fill="#FF5D5D5D" Tag="#FF5D5D5D" RadiusX="4" RadiusY="4"/>
                                </GridView.Items>
                            </GridView>

                            <Expander Header="{x:Bind GetText('Settings_CustomColor_Header'), Mode=OneWay}" HorizontalAlignment="Stretch">
                                <Grid Padding="16" RowSpacing="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <ColorPicker x:Name="AdvancedColorPicker" 
                                                 IsAlphaEnabled="False" 
                                                 IsHexInputVisible="True" 
                                                 IsColorSliderVisible="True" 
                                                 IsMoreButtonVisible="True"
                                                 ColorSpectrumShape="Ring"
                                                 HorizontalAlignment="Center"
                                                 ColorChanged="AdvancedColorPicker_ColorChanged"/>
                                    <Button Grid.Row="1" Content="{x:Bind GetText('Settings_ApplyColor_Button'), Mode=OneWay}" 
                                            HorizontalAlignment="Stretch"
                                            Padding="10"
                                            Style="{StaticResource AccentButtonStyle}"
                                            Click="ApplyCustomColor_Click"/>
                                </Grid>
                            </Expander>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>